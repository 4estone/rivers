rivers
======

Compute river basins based on OSM data.

This tool is intended to create maps of river basins like [Flussgebiete Deutschlands](http://www.kompf.de/gps/rivermap.html).

prerequisites
-------------

* Linux 64 bit (eg. Ubuntu 12.04)

* Java JDK 1.6, Ant, Ivy

* Osmium fork from [skaringa](https://github.com/skaringa/osmium)

* [Tilemill](http://mapbox.com/tilemill/)

workflow
--------

1. Compile Osmium/osmjs. See [OSM wiki](http://wiki.openstreetmap.org/wiki/Osmium/Quick_Start) to get started.

2. Compile rivers:

        ant -lib /usr/share/java
    
3. Download germany.osm.pbf file from [Geofabrik](http://download.geofabrik.de/). 
   Generally the tool should work with other regions as well, but in that case you probably need to add 
   more names and IDs to [WellknownRivers.java](https://github.com/skaringa/rivers/blob/master/src/com/skaringa/riversystem/WellknownRivers.java).

4. Run *osmjs* to create shapefiles and CSV files with config_rivermap: 

        osmjs -2 -m -l sparsetable -i osm2shape.js -j js/config_rivermap.js germany.osm.pbf
    
5. Run *rivers* with the CSV files generated by osmjs to build the river basins: 

        ant -lib /usr/share/java -Dargs="wways.csv wtr.csv rsystems.csv"  RunRiverSystems
    
   This creates the CSV file *rsystems.csv* that contains the mapping of the OSM way ID to the name of the river basin.
  
6. Merge this CSV file into the waterways shape file:

        ant -lib /usr/share/java -Dargs="waterways.shp rsystems.csv waterways-r.shp" RunJoinCsv
    
   Alternatively you may use other tools, like [Quantum GIS](http://www.qgis.org/) to merge CSV and shape file.

7. Use *tilemill* to render, customize, and export the map.

